---
#title: "Spatial and temporal effects on SARS-CoV-2 contamination of the healthcare environment"
#author: "Brendan J. Kelly, MD, MS"
bibliography: bib/references.bib
csl: csl/infection-control-and-hospital-epidemiology.csl
output: html_document
css: style_helvetica_double.css
---

```{r setup, echo=FALSE, eval=TRUE, include=FALSE, autodep=TRUE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(tidybayes)
library(gt)

read_csv("./data/dat_long.csv") %>%
  identity() -> dat_long
dat_long


dat_long %>%
  group_by(subject_room_id) %>%
  filter(subject_room_day == min(subject_room_day)) %>%
  ungroup() %>%
  identity() -> dat_first
dat_first

dat_long %>%
  # exclude bathroom sites and nursing sites (different distance scheme)
  filter(grepl("bathroom|sink|toilet|nurse",site_descriptor) == FALSE) %>%
  mutate(scv2_detected = !is.na(copies_max),
         site_category = case_when(grepl("floor",site_descriptor) == TRUE ~ "floor",
                                   grepl("floor",site_descriptor) == FALSE ~ "elevated"),
         high_touch = touch == "High") %>%
  #count(site_descriptor, site_category, high_touch)
  select(subject_room_id, redcap_id, subject_room_day, subject_covid_day, subject_hosp_day, total_study_day, swab_site, unit, site_category, touch, high_touch, distance, copies_max, scv2_detected) %>%
  mutate(redcap_id = paste0("decon_subject_", redcap_id)) %>%
  mutate(site_category = stringr::str_to_title(gsub("_"," ",site_category))) %>%
  distinct() %>%
  identity() -> dat

m_mvbinom_scv2_distance_fix_category_touch <- read_rds(file = "./models/binomial/m_mvbinom_scv2_distance_fix_category_touch.rds.gz")

m_mvbinom_scv2_time_fix_category_touch <- read_rds(file = "./models/binomial/m_mvbinom_scv2_time_fix_category_touch.rds.gz")

m_mvbinom_scv2_time_category_touch_mix_subject <- read_rds(file = "./models/binomial/m_mvbinom_scv2_time_category_touch_mix_subject.rds.bz2")

m_mvbinom_scv2_time_fix_category_touch_adjust_wave <- read_rds(file = "./models/binomial/m_mvbinom_scv2_time_fix_category_touch_adjust_wave.rds.gz")

tibble(model = list(m_mvbinom_scv2_distance_fix_category_touch, m_mvbinom_scv2_time_fix_category_touch, m_mvbinom_scv2_time_category_touch_mix_subject, m_mvbinom_scv2_time_fix_category_touch_adjust_wave), model_name = c("Distance Fixed", "Time Fixed", "Time Subject Random", "Time Pandemic Wave Adjusted")) %>%
  mutate(model_summary = map(model, .f = ~ brms::posterior_summary(.x) %>% as_tibble(rownames = "param"))) %>%
  select(model_name, model_summary) %>%
  unnest(cols = c(model_summary)) %>%
  mutate_if(.predicate = ~ is.numeric(.x), .funs = list("exp" = ~ exp(.x))) %>%
  identity() -> m_combined_summary




```


## Title  
Spatial and temporal effects on SARS-CoV-2 contamination of the healthcare environment  
  
## Abbreviated Title  
SARS-CoV-2 Healthcare Contamination    
  
## Authors  
Matthew J. Ziegler, MD, MS (1,2,3); Selamawit Bekele (2,3); Sean Loughrey, MS (2,3); Emily Reesey, MS (2,2); Elizabeth Huang (2,3); Pam Tolomeo, MPH (2,3); Ebbing Lautenbach, MD, MPH, MS (1,2,3); Brendan J. Kelly, MD, MS (1,2,3) for the CDC Prevention Epicenters Program  
  
## Affiliations  
1 - Division of Infectious Diseases, Department of Medicine;   
2 - Department of Biostatistics, Epidemiology, and Informatics;  
3 - Center for Clinical Epidemiology and Biostatistics, Perelman School of Medicine, University of Pennsylvania, Philadelphia, PA    
  
## Corresponding Author Contact  
Brendan J. Kelly, MD, MS - brendank@pennmedicine.upenn.edu  
  
## Authors' Contributions  
MJZ - study design, data collection and analysis, manuscript;  
SB - subject enrollment and specimen collection;  
SL - specimen processing and analysis;  
ER - specimen processing and analysis;  
EH - specimen collection and processing;   
PT - subject enrollment and specimen collection, manuscript;  
MZD - study design, manuscript;  
EL - study design, manuscript;  
BJK - study design, data collection and analysis, manuscript;  
    
## Disclosures  
The authors report no relevant disclosures.  
  
## Data Availability  
Data, analysis scripts, and model code are available at github.com/bjklab.    
  
## Keywords  
SARS-CoV-2, COVID-19, hospital microbiome    
  
### Acknowledgements:  
This research, BJK, MJZ, and EL are supported in part by a CDC Cooperative Agreement FOA#CK16-004 "Epicenters for the Prevention of Healthcare Associated Infections”. BJK is supported by the National Institute for Allergy and Infectious Diseases (K23 AI121485 and L30 AI120149). MJZ is supported by the National Institute for Allergy and Infectious Diseases (K23 AI143925).   

### Disclosures:  
The authors report no conflicts of interest.    
  
### Word Count:    
?????       
  
  
-----
\newpage
<P style = "page-break-before: always">
  
## Manuscript  
  
### Abstract  
  
* __Background__:        
  
* __Methods__:         
  
* __Results__:      
    
* __Conclusions__:       
  
  
 <!-- -----
\newpage
<P style = "page-break-before: always">
  
### Importance  
  
If required by journal. -->   
  
  
-----  
\newpage
<P style = "page-break-before: always">
  
### Introduction:    
  
Despite infection control measures, transmission of SARS-CoV-2 infection has been observed in the healthcare and hospital settings. In a recent study of SARS-CoV-2-infected and -uninfected patients inadvertently roomed together, 39% of exposed uninfected patients developed COVID-19. Risk of SARS-CoV-2 transmission was associated with source patients who had low cycle threshold (Ct), i.e., high viral load, in their diagnostic testing [@Karan2021-cm].  
 
SARS-CoV-2 transmission can be mediated by droplets, aerosols, or fomites. Prior studies have demonstrated that SARS-CoV-2 extensively contaminates surfaces in the healthcare environment [@Morawska2021-mv]. But the spatial extent of contamination -- and how contamination changes during the course of hospitalization -- remain less well understood [@Mody2021-ag].  

We have previously applied spatial mapping and systematic sampling to define how multidrug-resistant organisms cluster in the hospital environment [site pending ICHE manuscript]. We now extend the methods we have developed to understand how SARS-CoV-2 contamination is distributed spatially, and how it changes over time.  
  
  
-----  
\newpage
<P style = "page-break-before: always">
  
  
### Materials and Methods:  
  
* __Study Design, Setting, and Population__: We performed a prospective cohort study at the Hospital of the University of Pennsylvania (HUP), an academic medical center in Philadelphia, PA, USA. (IRB protocol #8).   
  
* __Causal Model__: We hypothesized that SARS-CoV-2 contamination would decay with physical distance from patient and with time from COVID-19 diagnosis. We also hypothesized that high-touch objects would be more frequently contaminated with SARS-CoV-2 RNA than low-touch objects.     
  
* __Specimen Collection and SARS-CoV-2 RT-PCR__:    
   
* __Distance Data Collection__: Distances from the environmental sampling site to the patient bed was recorded using a laser measuring device (Bosch GLM 20). Researchers positioned the laser measure at the head of the bed within the room and recorded distances to the in-room ...      
  
* __Definition of Exposures and Outcomes__:         
  
* __Statistical Methods__: Data were organized using R statistical software version 3.6.1 [@R_Core_Team2018-xo], and plots generated using the “ggplot2” package [@Wickham2016-eh]. We examined how (1) distance from the patient and (2) time since COVID-19 diagnosis relate to the probability of SARS-CoV-2 detection using a binomial model with a logit link. We also evaluated mixed-effects model incorporating a random effect for subjects to account for clustering of longitudinal data, and to evaluate inter-subject differences. Models were fit using Stan Hamiltonian Monte Carlo (HMC) version 2.21, via the "brms" package with default, weakly-informative priors [@Carpenter2017-ec; @Burkner2017-yr]. Prior predictive modeling was performed, and models were fit with 4 chains of 1000 iterations, confirmed with HMC diagnostics (no divergent iterations, Rhat statistic < 1.1 for all parameters, and E-BFMI > 0.2) [@McElreath2016-sf; @Gabry2019-le; @Gelman2020-sd]. We examined parameter distributions at 50%, 80%, and 95% posterior credible intervals to understand the relationship between exposure and outcome variables.  
  
* __Power and Sample Size__: We anticipated that the enrollment of ... subjects would permit ... with type 1 error less than 0.05.    
  
* __Availability of Data__: Data, analysis scripts, and model code are available at https://github.com/bjklab.  
  
  
-----  
\newpage
<P style = "page-break-before: always">
  
  
### Results:  
  
* __Characteristics of subjects hospitalized for COVID-19 during the second (fall 2020) wave__: We collected `r nrow(dat)` specimens from `r nrow(count(dat,subject_room_id))` unique subject-room pairs, comprising `r nrow(count(dat,redcap_id))` unique subjects (i.e., `r nrow(filter(count(distinct(select(dat,subject_room_id,redcap_id)),redcap_id),n>1))` subjects were transferred at least once during the observation period). The median number of sampling events from each subject-room pair was `r round(mean(count(distinct(select(dat, subject_room_id, subject_room_day)), subject_room_id)$n, na.rm = TRUE),2)` (SD `r round(sd(count(distinct(select(dat, subject_room_id, subject_room_day)), subject_room_id)$n, na.rm = TRUE),2)`). **Table 1** summarizes the environmental surfaces sampled, whether they were high-touch or low-touch, and proportion of each specimen type from which SARS-CoV-2 RNA was detected by RT-PCR....        
  
* __SARS-CoV-2 RNA Environmental Contamination Varies with Surface Type But Not Distance from Patient__: We evaluated the relationship between the distance from the patient's head of the bed and the probability of detecting SARS-CoV-2 on environmental surfaces. There was no significant relationship between distance and the probability of SARS-CoV-2 detection, in contrast to prior studies of MDRO organisms [site ICEMAN ICHE paper], but the suface type was significantly associated with the probability of detection. Floor surfaces had an odds ratio of `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_site_categoryFloor") %>% pull(Estimate_exp) %>% round(.,2)` (95% CrI `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_site_categoryFloor") %>% pull(Q2.5_exp) %>% round(.,2)` to `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_site_categoryFloor") %>% pull(Q97.5_exp) %>% round(.,2)`) of SARS-CoV-2 detection, relative to elevated surfaces. High-touch elevated surfaces had an odds ratio of `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_high_touchTRUE") %>% pull(Estimate_exp) %>% round(.,2)` (95% CrI `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_high_touchTRUE") %>% pull(Q2.5_exp) %>% round(.,2)` to `r m_combined_summary %>% filter(model_name == "Distance Fixed" & param == "b_high_touchTRUE") %>% pull(Q97.5_exp) %>% round(.,2)`) of SARS-CoV-2 detection, relative to low-touch elevated surfaces. **Figure 1A** depicts the results of a multivariable model relating distance from patient, surface location, and whether the surface was high-touch to the probability of SARS-CoV-2 detection.         
  
* __SARS-CoV-2 RNA Environmental Contamination Decays During Prolonged Hospitalization__: We ...           
  
* __SARS-CoV-2 Contamination of the Floor Increases with Pandemic Wave Duration__: We found... **Figure 2** ....    
  
* __SARS-CoV-2 Contamination of High-Touch Objects Depends on Subject Characteristics__: We found... **Table 2** ....    

  
  
-----  
\newpage
<P style = "page-break-before: always">
  
  
### Discussion:  
  
We sought to define  .  
  
We found  .  
  
The significance  .  
  
Our study has several limitations.  .     
  
In conclusion,   .  
      
  
  
  
  
-----
\newpage
<P style = "page-break-before: always">
  
  
### Tables:  
  
#### Table 1:   
  
```{r table1, eval=TRUE, autodep=TRUE, error=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

dat %>%
  left_join(distinct(select(dat_long, swab_site, site_descriptor)), by = "swab_site") %>%
  mutate(high_touch = case_when(high_touch == TRUE ~ "High Touch",
                                high_touch == FALSE ~ "Low Touch")) %>%
  mutate(site_descriptor = stringr::str_to_title(string = gsub("_"," ",gsub("1|2","",site_descriptor)))) %>%
  group_by(site_category, site_descriptor, high_touch) %>%
  summarise(unique_subjects = n_distinct(subject_room_id),
            unique_specimens = n(),
            prop_positive = sum(!is.na(copies_max)) / n()) %>%
  ungroup() %>%
  arrange(desc(prop_positive)) %>%
  gt::gt() %>%
  gt::cols_label(site_category = "Height", site_descriptor = "Location", high_touch = html("Contact"), prop_positive = html("SARS-CoV-2<br>Detected"), unique_subjects = html("Subjects<br>Sampled"), unique_specimens = html("Surfaces<br>Sampled")) %>%
  gt::fmt_percent(columns = prop_positive, decimals = 1) %>%
  identity() -> dat_gt
dat_gt

dat_gt %>%
  gt::as_raw_html() %>%
  write_lines("./tabs/surfaces_sampled.html")


```
  
  
__Table 1: Hospital environment features sampled and proportion with detectable SARS-CoV-2 RNA.__ .  
  
  
  
#### Table 2:   
  
```{r table2, eval=TRUE, autodep=TRUE, error=FALSE, message=FALSE, warning=FALSE, fig.align='center'}


```
  
  
__Table 2: Subject characteristics that increase risk of high-touch object contamination.__ .  
  





  
-----  
\newpage
<P style = "page-break-before: always">
  
### Figures:  
  
#### Figure 1:  
  
  
```{r fig1, eval=TRUE, autodep=TRUE, fig.align='center', out.width='90%'}
knitr::include_graphics(path = "./figs/p_combined_distance_time_unadjusted.png")
```
  
  
__Figure 1: Spatial and temporal effects on SARS-CoV-2 RNA contamination in the healthcare environment.__     
  
  
-----  
\newpage
<P style = "page-break-before: always">
  
#### Figure 2:  
  
```{r fig2, eval=TRUE, autodep=TRUE, fig.align='center', out.width='90%'}
knitr::include_graphics(path = "./figs/p_combined_subject_wave_time_adjusted.png")
```
  
  
__Figure 2: Variation in temporal effects and influence of pandemic duration.__ .         
  
  
-----  
\newpage
<P style = "page-break-before: always">
  
  
  
### Supplemental Figures:   
  
#### Supplemental Figure 1:  
  
```{r sfig1, eval=TRUE, autodep=TRUE, fig.align='center', out.width='60%'}
#knitr::include_graphics(path = "")
```
  
  
__Supplemental Figure 1: Figure caption__          
  
  
-----
\newpage
<P style = "page-break-before: always">
  
  
## References  
  
<div id="refs"></div>
  
  

  
-----
\newpage
<P style = "page-break-before: always">

  
## R Session Information  
  
```{r session_info, eval=TRUE, autodep=TRUE}
sessionInfo()
```



